<VirtualHost *:80>
  ServerName {{ vhostname }}
  DocumentRoot /var/www/wiki

  DirectoryIndex index.php

  # Enable the rewrite engine
  RewriteEngine On

  # Short URL for wiki pages
  RewriteRule ^/?{{ article_path_name }}(/.*)?$ %{DOCUMENT_ROOT}/index.php [L]

  <Directory /var/www/wiki/>
    Options -Indexes
    AllowOverride None

    <FilesMatch \.php$>
      SetHandler "proxy:unix:/var/run/php5-fpm.sock|fcgi://localhost/"
    </FilesMatch>
  </Directory>

  <Directory /var/www/wiki/images/>
    <FilesMatch \.php$>
      # Disable PHP file handler for uploaded files
      SetHandler None
    </FilesMatch>
  </Directory>
</VirtualHost>
